# AI 小伙伴 - 儿童智能陪伴系统

这是一个专门为儿童设计的AI陪伴系统，由一个叫"念念"的AI伙伴陪伴孩子成长。目前主要服务对象是一个叫"帅帅"的5岁小朋友。

## 🌟 特色功能

### 1. 温暖的语音对话
- 用温柔的声音和孩子交谈
- 能听懂孩子说的话并给出回应
- 会耐心倾听，不打断孩子说话
- 适合场景：
  * 孩子想找人说话的时候
  * 父母暂时没空陪伴时
  * 孩子需要倾诉的时候

### 2. 情感理解与支持
- 能察觉孩子是否开心、难过、生气或害怕
- 根据孩子的情绪给出安慰和鼓励
- 引导孩子学会表达感受
- 适合场景：
  * 孩子心情不好时
  * 遇到困难需要鼓励时
  * 想分享快乐的时候

### 3. 社交能力培养
- 帮助害羞的孩子建立自信
- 教会孩子如何交朋友
- 鼓励表达自己的想法
- 适合场景：
  * 孩子不知道如何交朋友时
  * 想练习社交对话时
  * 需要建立自信时

### 4. 智能记忆系统
- 记住与孩子的对话内容
- 记住孩子喜欢什么、不喜欢什么
- 能够延续之前的话题
- 适合场景：
  * 想继续之前的话题时
  * 回忆共同的经历时
  * 分享新鲜事物时

## 💡 应用场景举例

### 日常陪伴
- 早晨问候："帅帅，早上好！今天想和我说说话吗？"
- 情绪安抚："看你今天不太开心，想和念念说说发生了什么吗？"
- 分享快乐："真棒！和我说说今天最开心的事情吧！"

### 社交辅导
- 交友指导："帅帅，要不要和我练习一下怎么和新朋友打招呼？"
- 自信培养："你做得很棒！要相信自己，慢慢来没关系的。"
- 情绪表达："能告诉我为什么觉得害怕吗？我们一起想办法。"

### 学习成长
- 兴趣培养："你喜欢画画啊？给我讲讲你画的是什么吧！"
- 知识探索："想知道为什么天空是蓝色的吗？让我给你解释一下。"
- 生活技能："我们一起学习整理房间好不好？"

## 🎯 核心优势

1. **安全可靠**
   - 所有对话本地存储，保护隐私
   - 内容过滤，确保对话健康积极
   - 家长可随时查看对话记录

2. **个性化互动**
   - 根据孩子性格调整对话方式
   - 记住孩子的喜好和习惯
   - 针对性地培养和引导

3. **持续学习**
   - 通过对话了解孩子的变化
   - 不断优化互动策略
   - 成长记录可供回顾

## 🌈 使用建议

1. **固定时间互动**
   - 每天花10-15分钟和念念聊天
   - 可以在睡前分享一天的故事
   - 遇到开心或烦恼时随时倾诉

2. **循序渐进**
   - 先从简单的对话开始
   - 慢慢建立信任感
   - 逐步深入交流

3. **配合家长指导**
   - 家长可以旁听对话
   - 根据需要调整互动方式
   - 与家庭教育相辅相成

## 🚀 快速开始

### 环境要求
- Python 3.10+
- FFmpeg (音频处理)
- 有效的SSL证书

### 安装步骤

1. **克隆仓库**
```bash
git clone https://github.com/yourusername/AI_toy.git
cd AI_toy
```

2. **配置环境**
```bash
conda create -n AItoy python=3.10
conda activate AItoy
pip install -r requirements.txt
```

3. **设置环境变量**
```bash
# 在项目根目录创建 .env 文件
echo "DEEPSEEK_API_KEY=your_api_key_here" > .env
echo "XUNFEI_APPID=your_appid" >> .env
echo "XUNFEI_APIKEY=your_apikey" >> .env
echo "XUNFEI_APISECRET=your_apisecret" >> .env
```

4. **生成SSL证书**
```bash
mkdir -p ssl
openssl req -x509 -newkey rsa:4096 -keyout ssl/key.pem -out ssl/cert.pem -days 365 -nodes
```

5. **启动服务**
```bash
python main.py
```

访问 https://localhost:8001 (首次访问需信任SSL证书)

## 🔧 技术架构

### 核心组件
1. **语音处理**
   - **讯飞语音识别**：
     * WebSocket实时语音识别
     * 支持中文语音精准识别
     * 自动语音端点检测
     * 动态修正和噪音抑制
   - **Edge TTS语音合成**：
     * 使用zh-CN-XiaoxiaoNeural音色
     * 自然流畅的中文语音输出
     * 可配置的语音参数
   - **WebSocket实时通信**：
     * 全双工音频数据传输
     * 心跳检测机制
     * 自动重连和错误恢复

2. **对话系统**
   - **DeepSeek对话引擎**：
     * 基于大规模语言模型
     * 定制化儿童对话场景
     * 温和友好的对话风格
   - **LangChain对话管理**：
     * 基于ConversationBufferMemory的对话历史管理
     * AgentExecutor工具函数调用链
     * 自定义工具函数集成
     * 动态提示词模板
   - **LangGraph工作流**：
     * 基于DAG的对话流程控制
     * 状态转换和任务编排
     * 多轮对话管理
     * 条件分支和循环处理
   - **提示词模板**：
     * 针对儿童的交互设计
     * 情感理解和回应
     * 安全性过滤

### LangChain & LangGraph 实现

1. **LangChain组件**：
   - **记忆管理**：
     * 使用ConversationBufferMemory存储对话历史
     * 支持对话上下文的检索和维护
     * 自动管理对话长度和清理
   - **工具集成**：
     * 情感分析工具
     * 记忆检索工具
     * 状态更新工具
     * 主题管理工具
   - **代理执行器**：
     * 基于OpenAI函数调用的工具选择
     * 自动工具调用和结果处理
     * 错误处理和重试机制

2. **LangGraph工作流**：
   - **对话状态图**：
     * 初始状态 -> 意图理解
     * 意图理解 -> 工具选择
     * 工具选择 -> 执行操作
     * 执行操作 -> 响应生成
   - **状态转换**：
     * 基于对话内容的动态转换
     * 条件判断和分支处理
     * 异常处理和回退机制
   - **任务编排**：
     * 并行任务处理
     * 依赖关系管理
     * 任务优先级控制

3. **记忆系统**
   - **本地数据库**：
     * SQLite持久化存储
     * 对话历史记录
     * 用户偏好管理
   - **情感分析系统**：
     * 实时情绪识别
     * 情感变化追踪
     * 个性化回应策略
   - **知识库系统**：
     * 用户兴趣记录
     * 对话主题管理
     * 长期记忆存储

### 项目结构
```
AI_toy/
├── app/
│   ├── agent/             # AI代理相关代码
│   │   ├── companion_agent.py
│   │   ├── tools.py
│   │   └── prompts.py
│   ├── core/             # 核心功能
│   │   ├── memory.py
│   │   ├── speech.py
│   │   └── state.py
│   └── web/              # Web服务
│       └── server.py
├── config/               # 配置文件
├── models/              # AI模型
├── ssl/                 # SSL证书
├── main.py             # 程序入口
└── requirements.txt    # 依赖列表
```

## 🔍 常见问题

### 1. 连接问题
- 确保SSL证书配置正确
- 检查端口8001是否被占用
- 验证WebSocket连接状态

### 2. 音频问题
- 确保麦克风权限已授权
- 检查音频输入设备
- 验证FFmpeg安装

### 3. 性能优化
- 使用本地模型降低延迟
- 优化数据库查询
- 实现缓存机制

## 📝 开发计划

- [ ] 增加更多互动游戏
- [ ] 优化语音识别准确率
- [ ] 添加家长控制面板
- [ ] 扩展情感分析能力

## 🤝 贡献指南

1. Fork 项目
2. 创建特性分支
3. 提交更改
4. 发起 Pull Request

## 📄 许可证

MIT License

## 🙏 致谢

- DeepSeek API
- Whisper 模型
- Edge TTS
- LangChain 框架

## 📚 更多资源

- [API文档](docs/api.md)
- [开发指南](docs/development.md)
- [部署文档](docs/deployment.md)

### 系统架构图
```
AI_toy系统架构
├── 前端层
│   ├── 语音输入/输出
│   ├── WebSocket通信
│   └── 用户界面
├── 服务层
│   ├── FastAPI服务器
│   ├── 讯飞语音服务
│   └── Edge TTS服务
├── 核心层
│   ├── 对话管理(LangChain)
│   ├── AI对话(DeepSeek)
│   └── 状态管理
└── 数据层
    ├── SQLite数据库
    ├── 配置文件
    └── SSL证书
``` 
